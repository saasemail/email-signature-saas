'use client'
import { useState, useRef, useEffect } from 'react'
import html2canvas from 'html2canvas'
import jsPDF from 'jspdf'
import { QRCodeCanvas } from 'qrcode.react'

export default function Home() {
Â  const previewRef = useRef(null)
Â  const [charCounts, setCharCounts] = useState({ fullName: 0, jobTitle: 0 })

Â  const [form, setForm] = useState({
Â  Â  fullName: '',
Â  Â  jobTitle: '',
Â  Â  company: '',
Â  Â  phone: '',
Â  Â  website: '',
Â  Â  color: '#000000',
Â  Â  bgColor: '#ffffff',
Â  Â  image: null,
Â  Â  imageBase64: '',
Â  Â  template: 'classic'
Â  })

Â  useEffect(() => {
Â  Â  setCharCounts({
Â  Â  Â  fullName: form.fullName.length,
Â  Â  Â  jobTitle: form.jobTitle.length
Â  Â  })
Â  }, [form.fullName, form.jobTitle])

Â  const handleChange = (e) => {
Â  Â  const { name, value } = e.target
Â  Â  setForm((prev) => ({ ...prev, [name]: value }))
Â  }

Â  const handleImageUpload = (e) => {
Â  Â  const file = e.target.files[0]
Â  Â  if (!file) return
Â  Â  const reader = new FileReader()
Â  Â  reader.onloadend = () => setForm((prev) => ({ ...prev, image: file, imageBase64: reader.result }))
Â  Â  reader.readAsDataURL(file)
Â  }

Â  const getTemplateHTML = () => {
Â  Â  const { fullName, jobTitle, company, phone, website, color, bgColor, imageBase64, template } = form
Â  Â  const footer = `<div style="font-size:10px; margin-top:10px; opacity:0.6;">Generated by <a href="https://email-signature-saas.vercel.app" target="_blank" rel="noopener noreferrer" style="color:${color}; text-decoration:underline;">EmailSignatureSaaS</a></div>`

Â  Â  if (template === 'modern') {
Â  Â  Â  return `<div style="font-family:sans-serif; background:${bgColor}; color:${color}; padding:16px; border-left:4px solid ${color};">
Â  Â  Â  Â  Â  <div style="display:flex; align-items:center; gap:12px;">
Â  Â  Â  Â  Â  Â  ${imageBase64 ? `<img src="${imageBase64}" width="60" style="border-radius:8px;" />` : ''}
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  ${fullName ? `<div style="font-size:18px; font-weight:bold;">${fullName}</div>` : ''}
Â  Â  Â  Â  Â  Â  Â  ${jobTitle || company ? `<div>${jobTitle}${jobTitle && company ? ' @ ' : ''}${company}</div>` : ''}
Â  Â  Â  Â  Â  Â  Â  ${phone ? `<div>ğŸ“ ${phone}</div>` : ''}
Â  Â  Â  Â  Â  Â  Â  ${website ? `<div>ğŸŒ <a href="${website}" target="_blank" rel="noopener noreferrer" style="color:${color};">${website}</a></div>` : ''}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  ${footer}
Â  Â  Â  Â  </div>`
Â  Â  }

Â  Â  if (template === 'bold') {
Â  Â  Â  return `<div style="font-family:Arial Black; background:${bgColor}; color:${color}; padding:20px; text-transform:uppercase;">
Â  Â  Â  Â  Â  ${imageBase64 ? `<img src="${imageBase64}" width="100" style="margin-bottom:10px;" />` : ''}
Â  Â  Â  Â  Â  ${fullName ? `<div style="font-size:20px;">${fullName}</div>` : ''}
Â  Â  Â  Â  Â  ${jobTitle || company ? `<div style="margin:4px 0;">${jobTitle}${jobTitle && company ? ' - ' : ''}${company}</div>` : ''}
Â  Â  Â  Â  Â  ${(phone || website) ? `<div>${phone ? phone : ''}${phone && website ? ' â€¢ ' : ''}${website ? `<a href="${website}" target="_blank" rel="noopener noreferrer" style="color:${color};">${website}</a>` : ''}</div>` : ''}
Â  Â  Â  Â  Â  ${footer}
Â  Â  Â  Â  </div>`
Â  Â  }

Â  Â  return `<table style="font-family:Arial; font-size:14px; background:${bgColor}; color:${color}; padding:10px;">
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  ${imageBase64 ? `<td style="padding-right:10px;"><img src="${imageBase64}" width="80" style="border-radius:6px;" /></td>` : ''}
Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  ${fullName ? `<strong>${fullName}</strong><br/>` : ''}
Â  Â  Â  Â  Â  Â  ${jobTitle || company ? `${jobTitle}${jobTitle && company ? ' at ' : ''}${company}<br/>` : ''}
Â  Â  Â  Â  Â  Â  ${phone ? `ğŸ“ ${phone}<br/>` : ''}
Â  Â  Â  Â  Â  Â  ${website ? `ğŸŒ <a href="${website}" target="_blank" rel="noopener noreferrer" style="color:${color};">${website}</a><br/>` : ''}
Â  Â  Â  Â  Â  Â  ${footer}
Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  </tr>
Â  Â  Â  </table>`
Â  }

Â  const copyToClipboard = () => {
Â  Â  navigator.clipboard.writeText(getTemplateHTML())
Â  Â  alert('Signature HTML copied!')
Â  }

Â  const downloadHTML = () => {
Â  Â  const blob = new Blob([getTemplateHTML()], { type: 'text/html' })
Â  Â  const url = URL.createObjectURL(blob)
Â  Â  const a = document.createElement('a')
Â  Â  a.href = url
Â  Â  a.download = 'signature.html'
Â  Â  a.click()
Â  Â  URL.revokeObjectURL(url)
Â  }

Â  const downloadPNG = () => {
Â  Â  if (!previewRef.current) return
Â  Â  html2canvas(previewRef.current).then((canvas) => {
Â  Â  Â  const link = document.createElement('a')
Â  Â  Â  link.href = canvas.toDataURL()
Â  Â  Â  link.download = 'signature.png'
Â  Â  Â  link.click()
Â  Â  })
Â  }

Â  const downloadPDF = () => {
Â  Â  if (!previewRef.current) return
Â  Â  html2canvas(previewRef.current).then((canvas) => {
Â  Â  Â  const imgData = canvas.toDataURL('image/png')
Â  Â  Â  const pdf = new jsPDF()
Â  Â  Â  const imgProps = pdf.getImageProperties(imgData)
Â  Â  Â  const pdfWidth = pdf.internal.pageSize.getWidth()
Â  Â  Â  const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width
Â  Â  Â  pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight)
Â  Â  Â  pdf.save('signature.pdf')
Â  Â  })
Â  }

Â  const resetForm = () => {
Â  Â  setForm({
Â  Â  Â  fullName: '', jobTitle: '', company: '', phone: '', website: '', color: '#000000', bgColor: '#ffffff', image: null, imageBase64: '', template: 'classic'
Â  Â  })
Â  }

Â  const copyPlainText = () => {
Â  Â  const text = `${form.fullName}\n${form.jobTitle} at ${form.company}\n${form.phone}\n${form.website}`
Â  Â  navigator.clipboard.writeText(text)
Â  Â  alert('Plain text copied!')
Â  }

Â  return (
Â  Â  <main className="min-h-screen bg-white text-black px-4 py-6 sm:px-6 lg:px-12">
Â  Â  Â  <h1 className="text-2xl sm:text-3xl font-bold mb-6 text-center">Email Signature Generator</h1>

Â  Â  Â  <div className="flex flex-col lg:flex-row gap-6">
Â  Â  Â  Â  <div className="flex-1 space-y-4">
Â  Â  Â  Â  Â  <input name="fullName" placeholder="Full Name" value={form.fullName} onChange={handleChange} className="w-full p-2 border rounded" />
Â  Â  Â  Â  Â  <p className="text-xs text-gray-500">{charCounts.fullName}/50</p>
Â  Â  Â  Â  Â  <input name="jobTitle" placeholder="Job Title" value={form.jobTitle} onChange={handleChange} className="w-full p-2 border rounded" />
Â  Â  Â  Â  Â  <p className="text-xs text-gray-500">{charCounts.jobTitle}/50</p>
Â  Â  Â  Â  Â  <input name="company" placeholder="Company" value={form.company} onChange={handleChange} className="w-full p-2 border rounded" />
Â  Â  Â  Â  Â  <input name="phone" placeholder="Phone Number" value={form.phone} onChange={handleChange} className="w-full p-2 border rounded" />
Â  Â  Â  Â  Â  <input name="website" placeholder="Website (https://...)" value={form.website} onChange={handleChange} className="w-full p-2 border rounded" />

Â  Â  Â  Â  Â  <div className="flex gap-4">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm">Text Color</label>
Â  Â  Â  Â  Â  Â  Â  <input type="color" name="color" value={form.color} onChange={handleChange} />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <label className="block text-sm">Background</label>
Â  Â  Â  Â  Â  Â  Â  <input type="color" name="bgColor" value={form.bgColor} onChange={handleChange} />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label className="block text-sm mb-1">Upload Avatar / Logo</label>
Â  Â  Â  Â  Â  Â  <label className="inline-block px-4 py-2 bg-black text-white rounded cursor-pointer hover:bg-gray-800 transition">
Â  Â  Â  Â  Â  Â  Â  Choose File
Â  Â  Â  Â  Â  Â  Â  <input type="file" accept="image/*" onChange={handleImageUpload} className="hidden" />
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  {form.imageBase64 && (
Â  Â  Â  Â  Â  Â  Â  <img src={form.imageBase64} alt="preview" className="mt-2 h-20 rounded border" />
Â  Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <label className="block text-sm mb-1 mt-2">Choose Template</label>
Â  Â  Â  Â  Â  Â  <select name="template" value={form.template} onChange={handleChange} className="w-full p-2 border rounded">
Â  Â  Â  Â  Â  Â  Â  <option value="classic">Classic</option>
Â  Â  Â  Â  Â  Â  Â  <option value="modern">Modern</option>
Â  Â  Â  Â  Â  Â  Â  <option value="bold">Bold</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <button onClick={resetForm} className="mt-2 px-3 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition">Clear All</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div className="flex-1 bg-white border rounded p-4 overflow-auto">
Â  Â  Â  Â  Â  <div ref={previewRef} dangerouslySetInnerHTML={{ __html: getTemplateHTML() }} />
Â  Â  Â  Â  Â  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 mt-4">
Â  Â  Â  Â  Â  Â  <button onClick={copyToClipboard} className="px-3 py-2 bg-black text-white rounded hover:bg-gray-800 transition">Copy HTML</button>
Â  Â  Â  Â  Â  Â  <button onClick={copyPlainText} className="px-3 py-2 bg-gray-700 text-white rounded hover:bg-gray-800 transition">Copy Plain</button>
Â  Â  Â  Â  Â  Â  <button onClick={downloadHTML} className="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Download HTML</button>
Â  Â  Â  Â  Â  Â  <button onClick={downloadPNG} className="px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition">Download PNG</button>
Â  Â  Â  Â  Â  Â  <button onClick={downloadPDF} className="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition">Download PDF</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div className="mt-6 text-center">
Â  Â  Â  Â  Â  Â  <p className="text-sm mb-2 text-gray-500">QR Code (vCard contact info)</p>
Â  Â  Â  Â  Â  Â  <QRCode
Â  Â  Â  Â  Â  Â  Â  value={`BEGIN:VCARD\nFN:${form.fullName}\nORG:${form.company}\nTEL:${form.phone}\nURL:${form.website}\nEND:VCARD`}
Â  Â  Â  Â  Â  Â  Â  size={128}
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </main>
Â  )
}
